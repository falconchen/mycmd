#!/usr/bin/env python3
# ç®€ç¹è½¬ä¹‰

import json
import requests
import sys
import os

OPENAI_API_KEY = os.environ.get('OPENAI_API_KEY')
OPENAI_BASE_URL = os.environ.get('OPENAI_BASE_URL')


def query(message):

    if len(sys.argv) > 1:


        prompt ="ä½ æ˜¯ä¸€åç®€ä½“ç¹ä½“æ±‰å­—è½¬æ¢ä¸“å®¶ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„ç®€ä½“å­—è½¬æ¢æˆå°æ¹¾å›½è¯­çš„ç¹ä½“ï¼Œæˆ–å°†ç”¨æˆ·è¾“å…¥çš„ç¹ä½“å­—è½¬æ¢æˆç®€ä½“ã€‚å¹¶ä¸”å°½é‡ç¬¦åˆå½“åœ°çš„ç”¨æ³•ï¼Œå¦‚ç®€ä½“`åœ°é“`ï¼Œç¹ä½“ä¸º`æ·é‹`ï¼›ç®€ä½“`è½¯ä»¶`ï¼Œç¹ä½“ä¸º`è»Ÿé«”`ã€‚ ä»…è¾“å‡ºç»“æœï¼Œä¸è¦åšå¤šä½™çš„è§£é‡Šã€‚å¦‚æœä¸æ˜¯æ±‰å­—ï¼Œç›´æ¥è¾“å…¥åŸæ–‡å³å¯ã€‚"
        
    else:
        print("ç®€ç¹è½¬ä¹‰")
        print("Usage: jf word")
        return

    headers = {
        "Content-Type": "application/json",
        "Authorization": f"Bearer {OPENAI_API_KEY}"
    }


    data = {
        "model": "gpt-3.5-turbo",
        "temperature": 0,
        "top_p": 1,
        "frequency_penalty": 1,
        "presence_penalty": 1,
        "stream": False,
        "messages": [
            {"role": "system", "content": prompt},
            {"role": "user", "content": "è®¡ç®—æœºçš„å†…å­˜ä¸è¶³ï¼Œæˆ‘å‘ç°å¤ªåçš„å¤´å‘å¾ˆå¹²ç‡¥"},
            {"role": "assistant", "content": "é›»è…¦çš„è¨˜æ†¶é«”ä¸è¶³ï¼Œæˆ‘ç™¼ç¾å¤ªåçš„é ­é«®å¾ˆä¹¾ç‡¥"},

            {"role": "user", "content": "ä¹¦"},
            {"role": "assistant", "content": "æ›¸"},

            {"role": "user", "content": "è½¯ä»¶"},
            {"role": "assistant", "content": "è»Ÿé«”"},

            {"role": "user", "content": "è»Ÿé«”"},
            {"role": "assistant", "content": "è½¯ä»¶"},

            {"role": "user", "content": "åœ°é“"},            
            {"role": "assistant", "content": "æ·é‹"},            
            

            {"role": "user", "content": "Book"},
            {"role": "assistant", "content": "Book"},            

            {"role": "user", "content": "MPWeekly æ˜å‘¨ - é›»å­æ›¸"},
            {"role": "assistant", "content": "MPWeekly æ˜å‘¨ - ç”µå­ä¹¦"},

            {"role": "user", "content": "æˆ‘ä»¬åœ¨è€æŒçš„æœåŠ¡å™¨æœ‰ä¸€äº›ç¡¬ç›˜ï¼Œæ›¾ç»å¤šæ¬¡éœ€è¦ä½¿ç”¨äº’è”ç½‘ç®—æ³•è½¯ä»¶è§£å†³å¼‚æ­¥çš„é—®é¢˜"},
            {"role": "assistant", "content": "æˆ‘å€‘åœ¨è€æ’¾çš„æœå‹™å™¨æœ‰ä¸€äº›ç¡¬ç¢Ÿï¼Œæ›¾ç¶“å¤šæ¬¡éœ€è¦ä½¿ç”¨äº’è¯ç¶²ç®—æ³•è»Ÿä»¶è§£æ±ºéåŒæ­¥çš„å•é¡Œ"},

            

            
            {"role": "user", "content": message}
        ]
    }

    response = requests.post(OPENAI_BASE_URL, headers=headers, data=json.dumps(data))

    answer = json.loads(response.content)["choices"][0]["message"]["content"].strip()
    print("\033[32m---ğŸ¤–---------\033[0m")
    print(answer)
    print("\033[32m--------------\033[0m")


if __name__ == "__main__":
    query(" ".join(sys.argv[1:]))
